<div class="space-y-8 animate-in fade-in slide-in-from-bottom-6 duration-1000">
  
  <div class="flex flex-col md:flex-row md:items-end justify-between gap-6">
    <div>
      <h1
        class="text-3xl font-black text-white tracking-tighter uppercase italic"
      >
        Gestionnaire de <span class="text-cyan-500">Parc</span>
      </h1>
      <p
        class="text-[10px] font-bold text-slate-500 uppercase tracking-[0.3em] mt-1"
      >
        Audit Global / {{ totalElements }} Unités en Base
      </p>
    </div>

    
    <div class="flex flex-wrap items-center gap-3">
      <div class="relative group">
        <input
          [(ngModel)]="searchTerm"
          type="text"
          placeholder="Rechercher..."
          class="bg-slate-900/50 border border-slate-800 rounded-2xl px-6 py-3 pl-12 text-xs text-white placeholder:text-slate-600 focus:border-cyan-500/50 outline-none w-64 transition-all"
        />
        <svg
          class="w-4 h-4 text-slate-600 absolute left-4 top-3.5 group-hover:text-cyan-500 transition-colors"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
          />
        </svg>
      </div>

      <select
        [(ngModel)]="selectedStatus"
        class="bg-slate-900/50 border border-slate-800 rounded-2xl px-4 py-3 text-[10px] font-black uppercase text-slate-400 focus:border-cyan-500/50 outline-none transition-all cursor-pointer"
      >
        <option value="">Tous les Statuts</option>
        <option *ngFor="let s of statuses" [value]="s">{{ s }}</option>
      </select>

      <button
        *ngIf="searchTerm || selectedStatus"
        (click)="clearFilters()"
        class="text-rose-500 text-[10px] font-black uppercase tracking-widest px-4 hover:opacity-70 transition-opacity"
      >
        Réinitialiser
      </button>
    </div>
  </div>

  
  <div
    class="bg-slate-900 border border-slate-800 rounded-[2.5rem] overflow-hidden shadow-2xl relative transition-all duration-700 hover:border-slate-700"
  >
    
    <div
      *ngIf="isLoading"
      class="absolute inset-0 bg-slate-950/80 backdrop-blur-md z-30 flex flex-col items-center justify-center"
    >
      <div
        class="w-12 h-12 border-4 border-cyan-500/10 border-t-cyan-500 rounded-full animate-spin mb-4"
      ></div>
      <span
        class="text-[10px] font-black text-cyan-500 uppercase tracking-[0.4em]"
        >Lecture de la base...</span
      >
    </div>

    <div class="overflow-x-auto custom-scrollbar">
      <table class="w-full text-left border-collapse">
        <thead class="bg-slate-950/40 border-b border-slate-800">
          <tr
            class="text-[9px] font-black text-slate-500 uppercase tracking-[0.2em]"
          >
            <th class="p-6">Identifiant Flux</th>
            <th class="p-6">Logistique & Destinataire</th>
            <th class="p-6">État Opérationnel</th>
            <th class="p-6">Priorité</th>
            <th class="p-6 text-right">Actions Radar</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-slate-800/40">
          <tr
            *ngFor="let colis of filteredParcels"
            class="group hover:bg-slate-800/20 transition-all duration-300"
          >
            <td class="p-6">
              <div class="flex items-center gap-4">
                <div
                  class="w-10 h-10 rounded-xl bg-slate-950 border border-slate-800 flex items-center justify-center text-cyan-500 font-mono text-[10px] font-black group-hover:border-cyan-500/30 group-hover:shadow-[0_0_20px_rgba(34,211,238,0.05)] transition-all"
                >
                  ID
                </div>
                <div>
                  <div
                    class="text-sm font-black text-white tracking-tight uppercase"
                  >
                    #{{ colis.id?.substring(0, 8).toUpperCase() || "NEW" }}
                  </div>
                  <div class="text-[9px] font-bold text-slate-600 mt-0.5">
                    {{ colis.dateCreation | date: "medium" }}
                  </div>
                </div>
              </div>
            </td>
            <td class="p-6">
              <div class="text-xs font-black text-slate-200">
                {{ colis.destinataire?.nom || "Client" }}
                {{ colis.destinataire?.prenom }}
              </div>
              <div class="flex items-center gap-2 mt-1.5 opacity-60">
                <svg
                  class="w-3 h-3 text-cyan-500"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"
                  />
                </svg>
                <span
                  class="text-[9px] font-black uppercase tracking-widest text-slate-400"
                  >{{ colis.villeDestination || "Hub Global" }}</span
                >
                <span class="w-1 h-1 bg-slate-800 rounded-full"></span>
                <span class="text-[9px] font-bold text-slate-500 italic"
                  >{{ colis.poids }} KG</span
                >
              </div>
            </td>
            <td class="p-6">
              <div
                [class]="
                  'inline-flex items-center px-4 py-1.5 rounded-full text-[9px] font-black uppercase tracking-tighter ' +
                  getStatusColor(colis.statut)
                "
              >
                <span
                  class="w-1 h-1 rounded-full bg-current mr-2 animate-pulse"
                ></span>
                {{ (colis.statut || "PENDING").replace("_", " ") }}
              </div>
            </td>
            <td class="p-6">
              <div
                [class]="
                  'inline-flex items-center px-3 py-1 rounded-lg border text-[8px] font-black uppercase tracking-widest ' +
                  getPriorityColor(colis.priorite)
                "
              >
                {{ colis.priorite || "NORMAL" }}
              </div>
            </td>
            <td class="p-6 text-right">
              <div
                class="flex items-center justify-end gap-3 opacity-0 group-hover:opacity-100 transition-all translate-x-4 group-hover:translate-x-0"
              >
                <button
                  (click)="viewDetails(colis)"
                  class="p-2.5 bg-slate-950 border border-slate-800 hover:border-cyan-500/50 text-slate-500 hover:text-cyan-400 rounded-xl transition-all shadow-xl"
                >
                  <svg
                    class="w-4 h-4"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"
                    />
                  </svg>
                </button>
                <button
                  (click)="editParcel(colis)"
                  class="p-2.5 bg-slate-950 border border-slate-800 hover:border-amber-500/50 text-slate-500 hover:text-amber-400 rounded-xl transition-all shadow-xl"
                >
                  <svg
                    class="w-4 h-4"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"
                    />
                  </svg>
                </button>
              </div>
            </td>
          </tr>

          
          <tr *ngIf="!isLoading && filteredParcels.length === 0">
            <td colspan="5" class="p-24 text-center">
              <div
                class="flex flex-col items-center justify-center opacity-30 grayscale"
              >
                <div
                  class="w-20 h-20 rounded-full border-2 border-slate-800 border-dashed flex items-center justify-center mb-4"
                >
                  <svg
                    class="w-10 h-10"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"
                    />
                  </svg>
                </div>
                <p class="text-[10px] font-black uppercase tracking-[0.3em]">
                  Aucune Entrée Détectée
                </p>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    
    <div
      class="p-6 bg-slate-950/60 border-t border-slate-800 flex flex-col md:flex-row items-center justify-between gap-4"
    >
      <span
        class="text-[9px] font-black text-slate-600 uppercase tracking-widest italic"
      >
        Index: {{ currentPage * pageSize + 1 }} -
        {{ currentPage * pageSize + filteredParcels.length }} sur
        {{ totalElements }} nodes active
      </span>
      <div
        class="flex items-center gap-4 bg-slate-900 border border-slate-800 p-2 rounded-2xl shadow-xl"
      >
        <button
          [disabled]="currentPage === 0"
          (click)="prevPage()"
          class="p-2.5 rounded-xl hover:bg-slate-800 text-slate-500 hover:text-cyan-500 disabled:opacity-20 transition-all"
        >
          <svg
            class="w-4 h-4"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M15 19l-7-7 7-7"
            />
          </svg>
        </button>
        <div
          class="px-6 border-x border-slate-800 flex flex-col items-center min-w-[80px]"
        >
          <span class="text-[8px] font-black text-slate-500 uppercase italic"
            >Page</span
          >
          <span class="text-xs font-black text-white">{{
            currentPage + 1
          }}</span>
        </div>
        <button
          [disabled]="currentPage >= totalPages - 1"
          (click)="nextPage()"
          class="p-2.5 rounded-xl hover:bg-slate-800 text-slate-500 hover:text-cyan-500 disabled:opacity-20 transition-all"
        >
          <svg
            class="w-4 h-4"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M9 5l7 7-7 7"
            />
          </svg>
        </button>
      </div>
    </div>
  </div>

  
  <div
    *ngIf="isDetailModalOpen"
    class="fixed inset-0 z-50 flex items-center justify-center p-4 animate-in fade-in duration-300"
  >
    <div
      class="absolute inset-0 bg-slate-950/90 backdrop-blur-xl"
      (click)="closeDetails()"
    ></div>
    <div
      class="relative w-full max-w-2xl bg-slate-900 border border-slate-800 rounded-[3rem] shadow-[0_0_100px_rgba(34,211,238,0.1)] overflow-hidden"
    >
      <div
        class="p-8 border-b border-slate-800 flex justify-between items-center bg-slate-950/50"
      >
        <div>
          <h3
            class="text-2xl font-black text-white tracking-tighter italic uppercase"
          >
            Audit <span class="text-cyan-500">Flux</span>
          </h3>
          <p
            class="text-[9px] font-bold text-slate-500 uppercase tracking-widest mt-1"
          >
            Dossier #{{ selectedParcel?.id?.substring(0, 8).toUpperCase() }}
          </p>
        </div>
        <button
          (click)="closeDetails()"
          class="w-10 h-10 bg-slate-800 rounded-xl flex items-center justify-center text-slate-500 hover:text-white transition-all"
        >
          <svg
            class="w-5 h-5"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M6 18L18 6M6 6l12 12"
            />
          </svg>
        </button>
      </div>

      <div class="p-8 max-h-[60vh] overflow-y-auto custom-scrollbar">
        <div
          *ngIf="isLoadingHistory"
          class="py-24 flex flex-col items-center justify-center opacity-50 italic"
        >
          <div
            class="w-10 h-10 border-2 border-cyan-500/20 border-t-cyan-500 rounded-full animate-spin mb-4"
          ></div>
          <p
            class="text-[10px] font-black uppercase tracking-widest text-slate-500"
          >
            Extraction du journal...
          </p>
        </div>

        <div *ngIf="!isLoadingHistory" class="space-y-10">
          <div class="grid grid-cols-3 gap-6">
            <div
              class="bg-slate-950/50 p-6 rounded-3xl border border-slate-800 text-center"
            >
              <p class="text-[8px] font-black text-slate-600 uppercase mb-1">
                Masse
              </p>
              <p class="text-xl font-black text-white italic">
                {{ selectedParcel?.poids }} KG
              </p>
            </div>
            <div
              class="bg-slate-950/50 p-6 rounded-3xl border border-slate-800 text-center"
            >
              <p class="text-[8px] font-black text-slate-600 uppercase mb-1">
                Destination
              </p>
              <p
                class="text-xl font-black text-cyan-400 italic truncate uppercase px-2"
              >
                {{ selectedParcel?.villeDestination }}
              </p>
            </div>
            <div
              class="bg-slate-950/50 p-6 rounded-3xl border border-slate-800 text-center"
            >
              <p class="text-[8px] font-black text-slate-600 uppercase mb-1">
                Status
              </p>
              <p class="text-xl font-black text-white italic uppercase">
                {{ selectedParcel?.statut }}
              </p>
            </div>
          </div>

          <div class="space-y-6">
            <h4
              class="text-[10px] font-black text-slate-500 uppercase tracking-[0.4em] italic mb-6"
            >
              Chronologie de Vie
            </h4>

            <div
              *ngFor="let item of parcelHistory"
              class="relative pl-8 pb-10 border-l-2 border-slate-800 last:border-l-0"
            >
              <div
                class="absolute -left-2 top-0 w-3.5 h-3.5 rounded-full bg-slate-900 border-2 border-cyan-500 shadow-[0_0_10px_#22d3ee]"
              ></div>
              <div class="flex flex-col">
                <span
                  class="text-[10px] font-black text-slate-500 uppercase italic opacity-60"
                  >{{
                    item.dateModification | date: "MMM dd, yyyy · HH:mm"
                  }}</span
                >
                <span
                  class="text-white font-black text-sm tracking-tighter mt-1 uppercase"
                  >{{ item.statut?.replace("_", " ") }}</span
                >
                <div
                  class="mt-3 bg-slate-800/40 p-4 rounded-2xl text-[11px] text-slate-400 border border-slate-800/50 italic leading-relaxed"
                >
                  "{{
                    item.commentaire || "Rapport de transition automatisé."
                  }}"
                </div>
              </div>
            </div>

            <div
              *ngIf="parcelHistory.length === 0"
              class="flex flex-col items-center justify-center py-20 opacity-20"
            >
              <p
                class="text-[10px] font-black uppercase tracking-widest text-white"
              >
                Journal Vierge
              </p>
            </div>
          </div>
        </div>
      </div>

      <div
        class="p-8 bg-slate-950/80 border-t border-slate-800 flex justify-center"
      >
        <button
          (click)="closeDetails()"
          class="px-12 py-4 bg-white hover:bg-slate-100 text-slate-950 text-xs font-black uppercase tracking-widest rounded-2xl transition-all shadow-xl active:scale-95 italic font-black"
        >
          Fermer Archive
        </button>
      </div>
    </div>
  </div>
</div>
